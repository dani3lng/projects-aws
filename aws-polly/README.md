## Text Narrator

### Services Used
- Amazon Polly: Converts text to life like speech with customizable features.
- AWS Management Console: Manages accounts and configures Amazon Polly.
- AWS IAM: Ensures secure access by managing user permissions.

### Overview of Project
In this project, we will be developing a text narrator using Amazon Polly. A piece of text (book, article, newsletter) will be uploaded in an Amazon S3 bucket and converted to speech. The voice, pitch and speed parameters can be adjusted.

### Steps to be performed
1. Exploring Amazon Polly
2. Creating an IAM role
3. Creating an S3 Bucket
4. Writing Lambda function code
5. Checking the output of Amazon Polly

### Estimated Time & Cost
- This project is estimated to take about 20-30 minutes
- Cost: Free (When using the AWS Free Tier)

### Architectural Diagram
![picture](https://github.com/dani3lng/projects-aws/blob/main/aws-rekognition/label-generator/images/a1.png)

### Step by Step
1. Login to your AWS management console and search for Amazon Polly
2. Choose the desired engine:
    - Neural Engine: used for lifelike and expressive speech or for natural-sounding interactions.
    - Standard Engine: provides good quality speech suitable for most applications.
    - Long Form Engine: optimized for longer texts like articles or books that provides a good quality throughout the content.
3. Select desired language and voice tone
4. Search for IAM from the AWS management console
5. Navigate to Access Management > Roles > Create Role
6. Select "AWS service" as the trusted entity type and Lambda as your use case
7. Choose the following policies from the list:
    - AmazonPollyFullAccess
    - AmazonS3FullAccess
    - AWSLambdaBasicExecutionRole
8. Provide a suitable name and description for the IAM role and create role
9. Search for S3 from the AWS management console
10. Create a bucket with a suitable name, keep the rest of the configurations as is
    - Audio files generated by Amazon Polly will be stored in this bucket with the help of AWS Lambda
11. Navigate to Lambda from the AWS management console
12. Create a function with a suitable name
13. Choose "Node.js 16.x" as the runtime environment
14. Toggle the option "Change default configuration role" and check "Use existing role"
15. Choose the IAM role create earlier and leave the rest of the configurations as default
16. Rename your "index.mjs" file to "index.js"
17. We're using Amazon's tools (AWS SDK) to talk to two services: Polly (for making speech from text) and S3 (for storing files)
    - Javascript code:

    const AWS = require('aws-sdk');

    const polly = new AWS.Polly();
    const s3 = new AWS.S3();
18. We'll write a function that AWS will run for us whenever something happens. It's like a little program that waits for a signal to start working
    - Javascript code:

    exports.handler = async (event) => {
19. When the function gets a message with some text, we're going to turn it into speech. We decide how the speech will sound and what format it should be in
    - Javascript code:

    const text = event.text;

    const params = {
        Text: text,
        OutputFormat: 'mp3',
        VoiceId: 'Joanna' // You can change this to the desired voice
    };
20. We send the text to Polly and ask it into speech
21. Then, we save this speech in our S3 storage
    - Javascript code:

    const data = await polly.synthesizeSpeech(params).promise();

    const key = `audio-${Date.now()}.mp3`;

    const s3Params = {
        Bucket: 'your-bucket-name', // Replace with your S3 bucket name
        Key: key,
        Body: data.AudioStream,
        ContentType: 'audio/mpeg'
    };

    await s3.upload(s3Params).promise();
22. We make a message saying the speech has been saved successfully with its special name in our storage. If something goes wrong, there will be an error message instead
    - Javascript code:

    const outputMessage = `The audio file has been successfully stored in the S3 bucket by the name ${key}`;

    return {
        statusCode: 200,
        body: JSON.stringify({ message: outputMessage })
    };

    } catch (error) {
        console.error('Error:', error);
        return {
            statusCode: 500,
            body: JSON.stringify({ message: 'Internal server error' })
        };
    }
23. Full completed Lambda function code will look something like this:

const AWS = require('aws-sdk');

const polly = new AWS.Polly();
const s3 = new AWS.S3();

exports.handler = async (event) => {
    try {
        // Extract text input from the event
        const text = event.text;
        
        // Specify parameters for Polly
        const params = {
            Text: text,
            OutputFormat: 'mp3',
            VoiceId: 'Joanna' // You can change this to the desired voice
        };

        // Synthesize speech using Polly
        const data = await polly.synthesizeSpeech(params).promise();

        // Generate a unique key for the audio file
        const key = `audio-${Date.now()}.mp3`;

        // Specify parameters for S3
        const s3Params = {
            Bucket: 'your-bucket-name', // Replace with your S3 bucket name
            Key: key,
            Body: data.AudioStream,
            ContentType: 'audio/mpeg'
        };

        // Upload audio file to S3
        await s3.upload(s3Params).promise();

        const outputMessage = `The audio file has been successfully stored in the S3 bucket by the name ${key}`;

        return {
            statusCode: 200,
            body: JSON.stringify({ message: outputMessage })
        };
    } catch (error) {
        console.error('Error:', error);
        return {
            statusCode: 500,
            body: JSON.stringify({ message: 'Internal server error' })
        };
    }
};
24. Deploy the code changes
25. Test the function out by creating a test event
26. Provide a name for the test configuration and in the Event JSON, provide the text you want to be converted to audio in the form:
    - JSON code:

    {
	"text":"The text to be converted to Audio"
    }
27. Leave the rest of the configurations as default and click "Save"
28. Click on Test button again to invoke the test event
29. Check the output
30. The audio file can be accessed by checking it in the S3 bucket and downloading it

### Conclusion
Congratulations! You have successfully completed the project of text to speech translation using Amazon Polly, Lambda and S3 bucket.

What’s Next? Here is an idea that you can try out to make the project more interesting:

Create a website that will take the user input of text to be converted to speech, which will be passed to Lambda function for processing and the results are shown back on the website by providing the audio file.

Good luck exploring.

### Clean-up
Login to the AWS Management Console and go to S3 using the search bar. Select the S3 bucket created for this project and choose the ‘Delete’ option located in the top right corner of the general-purpose buckets section.

Next, navigate to Lambda from the search bar. Select the Lambda function created for this project and go to ‘Actions’ → ‘Delete’ option available in the top right corner.

Lastly, navigate to IAM from the search bar. Select the IAM role created for the Lambda function permissions and choose the ‘Delete’ option provided in the top right corner.

### Link to Application